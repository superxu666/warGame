var __reflect=this&&this.__reflect||function(e,n,t){e.__class__=n,t?t.push(n):t=[n],e.__types__=e.__types__?t.concat(e.__types__):t},__extends=this&&this.__extends||function(e,n){function t(){this.constructor=e}for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);t.prototype=n.prototype,e.prototype=new t},login;!function(e){var n=function(){function e(){}return e.sound="login/sound/",e.atlas="login/img/ui.png",e.skeleton="login/skeleton/",e.img="login/img/",e.d1sheetAlias="main/img/d1sheet.png",e.d2sheetAlias="main/img/d2sheet.png",e.d3sheetAlias="main/img/d3sheet.png",e}();e.Conf=n,__reflect(n.prototype,"login.Conf")}(login||(login={}));var login;!function(e){var n=function(n){function t(){return n.call(this)||this}return __extends(t,n),t.prototype.modulePreStart=function(){n.prototype.modulePreStart.call(this)},t.prototype.start=function(){var n=this;n.back=SkinManager.createImage(n,0,0,e.Conf.img+"rms_login_bg.jpg"),n.back.left=n.back.right=n.back.top=n.back.bottom=0;var t=sessionStorage.getItem("token");t&&(UserData.getInstance().token=t,UIControl.getInstance().closeCurUI(),UIControl.getInstance().openUI("main")),this.loginView=e.LoginLayout.getInstance(),n.loginView.layout(n);var i={1:function(){e.LoginModel.getInstance().loginPwd(n.loginView.phone,n.loginView.passw,function(){UIControl.getInstance().closeCurUI(),UIControl.getInstance().openUI("main"),BaseWar.getInstance().trigger("clear_login_all_info")})},2:function(){e.LoginModel.getInstance().loginCode(n.loginView.phone,n.loginView.code,function(){UIControl.getInstance().closeCurUI(),UIControl.getInstance().openUI("main"),BaseWar.getInstance().trigger("clear_login_all_info")})},3:function(){e.LoginModel.getInstance().resetPwd({username:n.loginView.phone,password:n.loginView.passw,code:n.loginView.code},function(){BaseWar.getInstance().trigger("clear_login_info"),n.loginView.switchMode("1")})},4:function(){e.LoginModel.getInstance().register({username:n.loginView.phone,password:n.loginView.passw,nickname:n.loginView.nickname,code:n.loginView.code},function(){BaseWar.getInstance().trigger("clear_login_info"),n.loginView.switchMode("1")})}};n.loginView.bindLogin(function(e){i[e]&&i[e]()},n),n.loginView.bindSend(function(){console.log(n.loginView.phone),console.log(n.loginView.code),e.LoginModel.getInstance().sendSms(n.loginView.phone,function(){})},n)},t.prototype.ready=function(){},t}(ModuleBase);e.Module=n,__reflect(n.prototype,"login.Module")}(login||(login={}));var login;!function(e){var n=function(){function n(){this.curMod="2";var e=this;e.switchBtnText={1:"切换到手机验证码>",2:"切换到密码登录>",3:"返回登录页面>",4:"返回登录页面>"},e.loginBtnText={1:"登录",2:"登录",3:"修改",4:"注册"}}return n.getInstance=function(){return n._instance?n._instance:n._instance=new n},n.prototype.layout=function(n){var t=this;console.log("layout - ",Main.instance.getRes("rms_view_bg_png",e.Conf.d1sheetAlias));var i=t.frame=SkinManager.createScaleImage(n,100,200,"rms_view_bg_png",e.Conf.d1sheetAlias,new GYLite.Scale9GridRect(100,100,100,100));i.width=680,i.height=410,i.horizonalCenter=0,t.c_phone=t.phone_c(i),t.c_passw=t.passw_c(i),t.c_code=t.code_c(i),t.c_nickname=t.nickname_c(i),t.loginBtn=SkinManager.createBtn(i,210,250,"rms_login_btn_bg_png",null,null,e.Conf.d1sheetAlias),t.loginBtn.label="登录",t.loginBtn.labelDisplay.size=26,t.loginBtn.labelDisplay.textColor=16777215,t.forgetPassw=SkinManager.createText(i,480,240,"忘记密码",16777215,20),t.visitor=SkinManager.createText(i,66,300,"游客登录",16777215,26),t.registry=SkinManager.createText(i,510,300,"快速注册",16777215,26),t.switchMod=SkinManager.createText(i,250,450,t.switchBtnText[2],16777215,26),t.forgetPassw.touchEnabled=t.visitor.touchEnabled=t.registry.touchEnabled=t.switchMod.touchEnabled=!0,t.bindEvent(),t.getLayout("2")},n.prototype.getLayout=function(e){var n=this,t={1:function(){n.c_nickname.visible=!1,n.c_passw.visible=!0,n.c_passw.y=n.c_phone.y+n.c_phone.height+10,n.c_code.visible=!1,n.forgetPassw.visible=!0,n.forgetPassw.x=480,n.forgetPassw.y=240,n.visitor.visible=!0,n.visitor.x=66,n.visitor.y=300,n.registry.visible=!0,n.registry.x=510,n.registry.y=300,n.loginBtn.y=250,n.frame.height=410,n.switchMod.y=n.frame.height+20},2:function(){n.c_nickname.visible=!1,n.c_code.visible=!0,n.c_code.y=n.c_phone.y+n.c_phone.height+10,n.c_passw.visible=!1,n.forgetPassw.visible=!1,n.visitor.visible=!0,n.visitor.x=66,n.visitor.y=300,n.registry.visible=!0,n.registry.x=510,n.registry.y=300,n.loginBtn.y=250,n.frame.height=410,n.switchMod.y=n.frame.height+20},3:function(){n.c_nickname.visible=!1,n.c_passw.visible=!0,n.c_passw.y=n.c_phone.y+n.c_phone.height+10,n.c_code.visible=!0,n.c_code.y=n.c_passw.y+n.c_passw.height+10,n.forgetPassw.visible=!1,n.visitor.visible=!1,n.registry.visible=!1,n.loginBtn.y=310,n.frame.height=450,n.switchMod.y=n.frame.height+20},4:function(){n.c_nickname.visible=!0,n.c_nickname.y=n.c_phone.y+n.c_phone.height+10,n.c_passw.visible=!0,n.c_passw.y=n.c_nickname.y+n.c_nickname.height+10,n.c_code.visible=!0,n.c_code.y=n.c_passw.y+n.c_passw.height+10,n.forgetPassw.visible=!1,n.visitor.visible=!1,n.registry.visible=!1,n.loginBtn.y=390,n.frame.height=510,n.switchMod.y=n.frame.height+20}};n.curMod=e,n.switchMod.text=n.switchBtnText[e],n.loginBtn.label=n.loginBtnText[e],t[e]&&t[e](),BaseWar.getInstance().trigger("clear_login_info")},n.prototype.bindEvent=function(){var e=this;e.switchMod.addEventListener(egret.TouchEvent.TOUCH_TAP,e.handleSwitch,e),e.forgetPassw.addEventListener(egret.TouchEvent.TOUCH_TAP,e.handleForget,e),e.registry.addEventListener(egret.TouchEvent.TOUCH_TAP,e.handleRegistry,e)},n.prototype.offEvent=function(){var e=this;e.switchMod.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.handleSwitch,e),e.forgetPassw.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.handleForget,e),e.registry.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.handleRegistry,e)},n.prototype.handleSwitch=function(){var e=this;e.getLayout("1"==e.curMod?"2":"2"==e.curMod?"1":"2")},n.prototype.switchMode=function(e){var n=this;n.getLayout(e)},n.prototype.handleForget=function(){var e=this;e.getLayout("3")},n.prototype.handleRegistry=function(){var e=this;e.getLayout("4")},n.prototype.bindLogin=function(e,n){var t=this;t.loginCallback=e,t.loginThisobj=n,t.loginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,t.handleLogin,t)},n.prototype.handleLogin=function(){var e=this;e.loginCallback&&e.loginCallback.call(e.loginThisobj,e.curMod)},n.prototype.bindSend=function(e,n){var t=this;t.sendCallback=e,t.sendThisobj=n},n.prototype.phone_c=function(n){var t=this,i=new GYLite.GYUIComponent,o=SkinManager.createText(i,0,0,"手机号",16777215,30);o.y=(78-o.height)/2;var a=TemplateTool.createTextInput(i,o.x+o.width+10,0,452,78,null,30);return a.skin=new GYLite.TextInputSkin(Main.instance.getRes("rms_login_input_bg_png",e.Conf.d2sheetAlias),new GYLite.Scale9GridRect),a.addEventListener(egret.Event.CHANGE,function(){t.phone=a.text},t),BaseWar.getInstance().bind("clear_login_all_info",function(){t.phone=a.text=""},t),a.paddingLeft=60,a.paddingRight=60,i.x=66,i.y=50,n.addElement(i),i},n.prototype.code_c=function(n){var t=this,i=new GYLite.GYUIComponent,o=SkinManager.createText(i,0,0,"验证码",16777215,30);o.y=(78-o.height)/2;var a=TemplateTool.createTextInput(i,o.x+o.width+10,0,452,78,null,30);a.skin=new GYLite.TextInputSkin(Main.instance.getRes("rms_login_input_bg_png",e.Conf.d2sheetAlias),new GYLite.Scale9GridRect),a.addEventListener(egret.Event.CHANGE,function(){t.code=a.text},t),BaseWar.getInstance().bind("clear_login_all_info",function(){t.code=a.text=""},t),BaseWar.getInstance().bind("clear_login_info",function(){t.code=a.text=""},t),a.textInput.y=10,a.paddingLeft=60,a.paddingRight=160;var s=SkinManager.createBtn(i,0,17,"rms_login__send_vitify_code_png",null,null,e.Conf.d1sheetAlias);return s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.sendCallback&&t.sendCallback.call(t.sendThisobj)},t),s.right=20,s.label="发送",s.labelDisplay.size=22,i.x=66,i.y=t.c_phone.y+t.c_phone.height+10,i.visible=!1,n.addElement(i),i},n.prototype.passw_c=function(n){var t=this,i=new GYLite.GYUIComponent,o=SkinManager.createText(i,0,0,"密码",16777215,30);o.y=(78-o.height)/2;var a=TemplateTool.createTextInput(i,o.x+o.width+40,0,452,78,null,30);a.skin=new GYLite.TextInputSkin(Main.instance.getRes("rms_login_input_bg_png",e.Conf.d2sheetAlias),new GYLite.Scale9GridRect),a.addEventListener(egret.Event.CHANGE,function(){t.passw=a.text},t),BaseWar.getInstance().bind("clear_login_all_info",function(){t.passw=a.text=""},t),BaseWar.getInstance().bind("clear_login_info",function(){t.passw=a.text=""},t),a.paddingLeft=60,a.paddingRight=60,a.textInput.displayAsPassword=!0,a.textInput.inputType=egret.TextFieldInputType.PASSWORD;var s=SkinManager.createBtn2(i,0,29,["rms_login__hide_password_png",null,null,null,"rms_login_display_password_png","rms_login_display_password_png","rms_login_display_password_png","rms_login_display_password_png"],e.Conf.d1sheetAlias);return s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.selected=!s.selected,a.textInput.displayAsPassword=!s.selected,a.textInput.inputType=s.selected?egret.TextFieldInputType.TEXT:egret.TextFieldInputType.PASSWORD},t),s.right=30,i.visible=!1,i.x=66,i.y=t.c_phone.y+t.c_phone.height+10,n.addElement(i),i},n.prototype.nickname_c=function(n){var t=this,i=new GYLite.GYUIComponent,o=SkinManager.createText(i,0,0,"昵称",16777215,30);o.y=(78-o.height)/2;var a=TemplateTool.createTextInput(i,o.x+o.width+40,0,452,78,null,30);return a.skin=new GYLite.TextInputSkin(Main.instance.getRes("rms_login_input_bg_png",e.Conf.d2sheetAlias),new GYLite.Scale9GridRect),a.addEventListener(egret.Event.CHANGE,function(){t.nickname=a.text},t),BaseWar.getInstance().bind("clear_login_all_info",function(){t.nickname=a.text=""},t),BaseWar.getInstance().bind("clear_login_info",function(){t.nickname=a.text=""},t),a.paddingLeft=60,a.paddingRight=60,i.visible=!1,i.x=66,i.y=t.c_phone.y+t.c_phone.height+10,n.addElement(i),i},n.createScrollGroup=function(e,n,t,i,o,a,s,r){void 0===e&&(e=null),void 0===a&&(a=!1),void 0===s&&(s=0),void 0===r&&(r=5);var c=new GYLite.GYScrollGroup;c.x=n,c.y=t,c.width=i,c.height=o,c.scrollerViewPort.canDrag=a,c.scroller.scrollBarH.alpha=s,c.scroller.scrollBarV.alpha=s,c.scroller.wheelScrollStep=r,c.touchEnabled=!0;var l,g=new GYLite.GYSprite;return l=g.graphics,l.beginFill(0,0),l.drawRect(0,0,c.width,100),l.endFill(),g.touchEnabled=!0,c.addElement(g),e&&e.addElement(c),c},n.prototype.openDrag=function(e,n){void 0===n&&(n=!0);var t,i=this;for(t=e.numElement;--t>-1;){var o=e.getElementAt(t);o.touchEnabled=!0,n||GYLite.DraggerHandle.getInstance(o).addBind(function(e){e.handle.x=e.handle.parent.mouseX-e.dragMouseX,e.handle.y=e.handle.parent.mouseY-e.dragMouseY},i)}e.addEventListener(egret.TouchEvent.TOUCH_END,function(e){console.log(e.target.imgname,e.target.width,e.target.height),console.log("x: ",e.target.x,"y: ",e.target.y)},e)},n}();e.LoginLayout=n,__reflect(n.prototype,"login.LoginLayout")}(login||(login={}));var login;!function(e){var n=function(){function e(){}return e.getInstance=function(){return e._instance||(e._instance=new e)},e.prototype.sendSms=function(e,n){BaseHttp.getInstance().sendMsg("/war/user/sendsms",{username:e},HTTPConf.M_POST,function(e){n&&n(e)},this)},e.prototype.register=function(e,n){BaseHttp.getInstance().sendMsg("/war/user/register",e,HTTPConf.M_POST,function(e){n&&n(e)},this)},e.prototype.resetPwd=function(e,n){BaseHttp.getInstance().sendMsg("/war/user/resetPwd",e,HTTPConf.M_POST,function(e){n&&n(e)},this)},e.prototype.loginPwd=function(e,n,t){BaseHttp.getInstance().sendMsg("/war/user/loginPwd",{username:e,password:n},HTTPConf.M_POST,function(e){UserData.getInstance().token=e.token,sessionStorage.setItem("token",e.token),t&&t(e)},this)},e.prototype.loginCode=function(e,n,t){BaseHttp.getInstance().sendMsg("/war/user/loginCode",{username:e,code:n},HTTPConf.M_POST,function(e){UserData.getInstance().token=e.token,sessionStorage.setItem("token",e.token),t&&t(e)},this)},e}();e.LoginModel=n,__reflect(n.prototype,"login.LoginModel")}(login||(login={}));